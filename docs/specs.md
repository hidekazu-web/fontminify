# FontMinify 機能仕様書

最終更新: 2025-12-11

## 1. 概要

FontMinifyは日本語フォントのサブセット化・最適化を行うmacOSデスクトップアプリケーション。

### 1.1 目的
- 日本語フォントファイルのサイズを90%以上削減
- Web用フォント（WOFF2）の生成を簡単に

### 1.2 対象ユーザー
- Webデザイナー・開発者
- フォントサイズを最適化したい一般ユーザー

---

## 2. 機能仕様

### 2.1 フォント入力

| 項目 | 仕様 |
|------|------|
| 入力方法 | ドラッグ&ドロップ / ファイル選択ダイアログ |
| 対応形式 | TTF, OTF, WOFF, WOFF2 |
| ファイルサイズ上限 | 100MB（推奨）、それ以上は処理時間増加 |
| 複数ファイル | 対応（順次処理） |

### 2.2 文字セットプリセット

| プリセット | 文字数 | 内容 |
|-----------|--------|------|
| 最小 | ~200 | ひらがな(83) + カタカナ(86) + ASCII(95) + 基本記号 |
| 基本 | ~1,000 | 最小 + 教育漢字(1,006) |
| 標準 | ~2,100 | 基本 + 常用漢字(2,136) |
| JIS第1水準 | ~3,000 | JIS X 0208 第1水準漢字(2,965) |

### 2.3 カスタム文字セット

| 項目 | 仕様 |
|------|------|
| 入力方法 | テキストエリアに直接入力 |
| 文字数制限 | 制限なし |
| 重複文字 | 自動除去 |
| 特殊文字 | 対応（絵文字含む） |

### 2.4 出力仕様

| 項目 | 仕様 |
|------|------|
| 出力形式 | WOFF2（デフォルト）、TTF、OTF、WOFF |
| 命名規則 | `{元ファイル名}-subset.{拡張子}` |
| 保存先 | ユーザー指定（ダイアログ表示） |

---

## 3. UI仕様

### 3.1 メイン画面構成

```
┌─────────────────────────────────────┐
│  FontMinify                    [_][x]│
├─────────────────────────────────────┤
│  ┌─────────────────────────────┐    │
│  │   ドラッグ&ドロップエリア    │    │
│  │   (フォントファイルをここへ)  │    │
│  └─────────────────────────────┘    │
│                                      │
│  📁 フォント情報                     │
│  ├─ ファイル名: NotoSansJP.ttf      │
│  ├─ サイズ: 15.2 MB                 │
│  ├─ グリフ数: 16,850                │
│  └─ フォント名: Noto Sans JP        │
│                                      │
│  📝 文字セット選択                   │
│  ○ 最小 (~200文字)                  │
│  ○ 基本 (~1,000文字)                │
│  ● 標準 (~2,100文字)                │
│  ○ JIS第1水準 (~3,000文字)          │
│  ○ カスタム [テキスト入力...]       │
│                                      │
│  ┌─────────────────────────────┐    │
│  │ [処理開始]  [キャンセル]      │    │
│  └─────────────────────────────┘    │
│                                      │
│  プログレスバー: ████████░░ 80%     │
│  推定削減率: 92%                     │
└─────────────────────────────────────┘
```

### 3.2 ダークモード対応

| 項目 | 仕様 |
|------|------|
| 検出方法 | macOSシステム設定を自動検出 |
| 切り替え | リアルタイム追従 |
| カラーテーマ | Tailwind CSSのダーク変数使用 |

### 3.3 Retina対応

| 項目 | 仕様 |
|------|------|
| アイコン | @2x解像度対応 |
| フォント | システムフォント使用 |
| 画像 | SVG優先 |

---

## 4. エラーハンドリング仕様

### 4.1 エラータイプ

| エラータイプ | 説明 | 復旧可能 |
|-------------|------|----------|
| INVALID_FILE | 非対応形式のファイル | Yes |
| CORRUPT_FONT | 破損したフォントファイル | No |
| FILE_TOO_LARGE | ファイルサイズ超過 | Yes |
| SAVE_FAILED | 保存失敗（権限/容量） | Yes |
| PROCESSING_FAILED | サブセット化処理失敗 | Yes |

### 4.2 エラー表示

```typescript
interface AppError {
  type: ErrorType;
  message: string;      // ユーザー向けメッセージ
  details?: string;     // 技術的詳細
  recoverable: boolean; // 復旧可能か
  suggestion?: string;  // 回復提案
}
```

---

## 5. パフォーマンス仕様

| 指標 | 目標値 | 測定方法 |
|------|--------|----------|
| 10MBフォント処理 | <10秒 | 処理開始〜完了 |
| メモリ使用量 | <300MB | 最大メモリ |
| UI応答性 | 60fps | FPS測定 |
| 起動時間 | <3秒 | アプリ起動〜操作可能 |

---

## 6. セキュリティ仕様

| 項目 | 設定 |
|------|------|
| コンテキスト分離 | 有効 |
| Node統合（レンダラー） | 無効 |
| CSPヘッダー | default-src 'self' |
| ファイルアクセス | メインプロセス経由のみ |
| IPC検証 | 全入力を検証 |

---

## 7. 対応環境

| 項目 | 仕様 |
|------|------|
| OS | macOS Big Sur (11.0) 以降 |
| アーキテクチャ | Intel (x64) / Apple Silicon (arm64) |
| メモリ | 4GB以上推奨 |
| ストレージ | 200MB以上の空き |

---

## 8. 今後の拡張予定

| 機能 | 優先度 | 状態 |
|------|--------|------|
| Windows対応 | 中 | 未着手 |
| バッチ処理 | 低 | 未着手 |
| CLI版 | 低 | 未着手 |

---

進捗状況は [progress.md](./progress.md) を参照
課題一覧は [issues.md](./issues.md) を参照
